
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
#divgenerosalario {
display: block;
max-width: 944px;
max-height: 472px;
margin: auto;
}

</style>
<div id="div_gen_sallary" class="col-md-12">
    <form id="myform3" method="POST" action="" enctype = "multipart/form-data" onchange="handleGenderSallary">
    {% csrf_token %}
    <label for="qtygendersalario">Escolha o numero de elementos máximo:</label>
    <select name="qtygendersalario" id="qtygendersalario">
      <option value="5">5</option>
      <option value="10" selected>10</option>
      <option value="15">15</option>
      <option value="20">20</option>
    </select>
    </form>
    <div id="divgenerosalario" class="col-md-12">
        <canvas id="generoXsalario"></canvas>
    </div>
</div>

<!-- Funções jQuery de atualização e afins -->
<script>
const handleGenderSallary = function(e) {
   var formData = $('#myform3').serialize()
   e.preventDefault(); // avoid to execute the actual submit of the form.
   $.ajax({
        url: "/update_graph/",
        data: formData + "&graph_name=generoXsalario",
        cache: false,
        dataType: 'json',
        type: 'POST',
        success: function (data, status) {
        		genderSallary = data.generoXsalario
				updateGraphGenderSallary(genderSallary)
				document.getElementById("qtygendersalario").value = genderSallary["Total"];
        }
    });
}

var select = document.getElementById('myform3');
select.addEventListener('change', handleGenderSallary);

</script>

<!-- Método que realiza a atualização do gráfico -->
<script>
function updateGraphGenderSallary(object_all){
	if (Object.keys(object_all).length == 0)
	{
		chartGenderSallary.destroy();
		document.getElementById("div_gender_vs_area").innerHTML += "Sem informações suficientes para gerar os gráficos!";
    }
    else
    {
    all_data = object_all["Data"]
    datasets = [];
    var colorArray = [ 'red' , 'blue' , 'green'];
    for (var i = 0 ; i < all_data.length ; i++){
        var dataset = {
                label : all_data[i][0],
                backgroundColor: colorArray[i],
                data:  all_data[i][1]
        };
        datasets.push(dataset);
    }

	chartGenderSallary.data.labels = object_all["Areas"]
	chartGenderSallary.data.datasets = datasets
	chartGenderSallary.update();
	}
}
</script>

<!-- Função que cria o gráfico inicialmente -->
<script>
function createGraphGenderSallary(object_all)
{
var colorArray = [ 'red' , 'blue' , 'green'];

var i = 0;
datasets = [];
{% for item in generoXsalario.Data %}
    var dataset = {
        label : "{{ item.0 | safe }}",
        backgroundColor: colorArray[i],
        data: {{ item.1 | safe }}
    };
    datasets.push(dataset);
    i += 1;
{%endfor%}

chartGenderSallary = new Chart(document.getElementById("generoXsalario"), {
    type: 'bar',
    data: {
      labels: object_all["Areas"],
      datasets: datasets
    },
    options: {
    scales: {
        yAxes: [{
            ticks: {
                stepSize: 1000
            }
        }]
    },
    plugins: {
      title: {
        display: true,
        text: 'Genero X Salario por Area'
      },
     },
      responsive: true,
    }
	});
}
</script>

<!-- Função do método init -->
<script>
function initGenderSallary(object_all) {

if (Object.keys(object_all).length == 0)
{
    document.getElementById("div_gen_sallary").innerHTML = "Sem informações suficientes para gerar os gráficos!";
}
else
{
document.getElementById("qtygendersalario").value = object_all["Total"];

createGraphGenderSallary(object_all)
}
}
</script>

<!-- Execucao inicial do método init -->
<script>
    var chartGenderSallary;
    var genderSallary = {{ generoXsalario | safe }}
    initGenderSallary(genderSallary);
</script>