
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<style>
#divgeneroCourseComparation {
display: block;
max-width: 944px;
max-height: 472px;
margin: auto;
}

</style>

<div id="div_gen_uni" class="col-md-12">
<form id="myform2" method="POST" action="" enctype = "multipart/form-data" onchange="handlerGenderCourseComparation">
{% csrf_token %}
<label for="qtygenderCourseComparation">Escolha o numero de elementos máximo:</label>
<select name="qtygenderCourseComparation" id="qtygenderCourseComparation">
  <option value="5">5</option>
  <option value="10" selected>10</option>
  <option value="15">15</option>
  <option value="20">20</option>
</select>
<br>
<label for="entitygenderComparation">Comparacao por:</label>
<select name="entitygenderComparation" id="entitygenderComparation">
     <option value="Instituicao" selected>Instituicao</option>
     <option value="Curso">Curso</option>
</select>
<label for="genderComparation">Genero:</label>
<select name="genderComparation" id="genderComparation"></select>
<label for="courseComparation">Curso:</label>
<select name="courseComparation" id="courseComparation"></select>
<br>
<label for="statesComparation">Estado:</label>
<select name="statesComparation" id="statesComparation"></select>
</form>
<div id="divgeneroCourseComparation">
    <div id="no-data-gender-course-comparation">
        <h2>Informação insuficiente para gerar o gráfico</h2>
    </div>
    <canvas id="generoXcursoCompare" ng-if="data != 0"></canvas>
</div>
</div>

<!-- Create Request based on the parameters -->
<script>
	function createRequest()
	{
		request = {}
		var companyValue = $("#companyGenderXLaborMarket").select2('data').text;
		request["companyGenderXLaborMarket"] = companyValue
	    var stateValue = $("#statesGenderXLaborMarket").select2('data').text;
		request["statesGenderXLaborMarket"] = stateValue
		var areaValue = $("#areaGenderXLaborMarket").select2('data').text;
		request["areaGenderXLaborMarket"] = areaValue
		request["graph_name"] = "generoXmercadodetrabalho"
		request["csrfmiddlewaretoken"] = "{{ csrf_token }}"
		return request
	}

</script>

<!-- Funções jQuery de atualização e afins -->
<script>
const handlerGenderCourseComparation = function(e) {
   var formData = $('#myform2').serialize()
   e.preventDefault(); // avoid to execute the actual submit of the form.
   $.ajax({
        url: "/update_graph/",
        data: formData + "&graph_name=generoXcursoCompare",
        cache: false,
        dataType: 'json',
        type: 'POST',
        success: function (data, status) {
        		genderCourseComparation = data.generoXcursoCompare
				updateGraphGenderCourseComparation(genderCourseComparation)
				select = document.getElementById("statesComparation")
				select.value = genderCourseComparation.State;
				document.getElementById("qtygenderCourseComparation").value = genderCourseComparation["Total"];
				document.getElementById("entitygenderComparation").value = genderCourseComparation["Entity"];

				select = document.getElementById("genderComparation")
				 $("#genderComparation").empty();

				 instValues = genderCourseComparation.Genders;

				 for (const value of instValues)
				 {
					  var option = document.createElement("option");
					  option.value = value;
					  option.text = value.charAt(0).toUpperCase() + value.slice(1);
					  select.appendChild(option);
				 }
				 select.value = genderCourseComparation.Gender;

				 select = document.getElementById("courseComparation")
				 $("#courseComparation").empty();

                 var option = document.createElement("option");
                 option.value = "Todos";
                 option.text = "Todos";
                 select.appendChild(option);

				 instValues = genderCourseComparation.Courses;

				 for (const value of instValues)
				 {
					  var option = document.createElement("option");
					  option.value = value;
					  option.text = value.charAt(0).toUpperCase() + value.slice(1);
					  select.appendChild(option);
				 }
				 select.value = genderCourseComparation.Course;

				 select = document.getElementById("statesComparation")
				 $("#statesComparation").empty();

                instValues = genderCourseComparation.States;

                var option = document.createElement("option");
                option.value = "Todos";
                option.text = "Todos";
                select.appendChild(option);

                for (const state of instValues)
                {
                    var option = document.createElement("option");
                    option.value = state;
                    option.text = state.charAt(0).toUpperCase() + state.slice(1);
                    select.appendChild(option);
                }
                select.value = genderCourseComparation.State;

        }
    });
}

var select = document.getElementById('myform2');
select.addEventListener('change', handlerGenderCourseComparation);

</script>

<!-- Método que realiza a atualização do gráfico -->
<script>
function updateGraphGenderCourseComparation(object_all)
{
	if (Object.keys(object_all).length == 0 || Object.keys(object_all["Data"]).length == 0)
	{
	    document.getElementById('no-data-gender-course-comparation').style.display = 'block';
        document.getElementById('generoXcursoCompare').style.display = 'none'
    }
    else
    {
        document.getElementById('no-data-gender-course-comparation').style.display = 'none';
        document.getElementById('generoXcursoCompare').style.display = 'block'
        var colorArray = [ 'blue'];
        chartGenderCourseComparation.data.labels = object_all["Entities"]
        chartGenderCourseComparation.data.datasets[0].label = object_all["Gender"]
        chartGenderCourseComparation.data.datasets[0].backgroundColor = colorArray[0]
        chartGenderCourseComparation.data.datasets[0].data = object_all["Data"]
        chartGenderCourseComparation.update();
	}
}
</script>

<!-- Função que cria o gráfico inicialmente -->
<script>
function createGraphGenderCourseComparation(object_all)
{
var colorArray = [ 'blue'];

chartGenderCourseComparation = new Chart(document.getElementById("generoXcursoCompare"), {
        type: 'bar',
        data: {
          labels: object_all["Entities"],
          datasets: [{
                label : object_all["Gender"],
                backgroundColor: colorArray[0],
                data: object_all["Data"]
            }]
        },
        options: {
        scales: {
        yAxes: [{
            ticks: {
                min: 0,
                max: 100,
                stepSize: 20
            }
        }]
        },
      title: {
            display: true,
            text: 'Comparativo Genero em (%)'
         },
        }
        });
}
</script>

<!-- Função do método init -->
<script>
function initGenderCourseComparation(object_all) {

if (Object.keys(object_all).length == 0)
{
    document.getElementById("divgeneroCourseComparation").innerHTML = "Sem informações suficientes para gerar os gráficos!";
}
else
{
document.getElementById("qtygenderCourseComparation").value = object_all["Total"];

select = document.getElementById("statesComparation")

all_states = object_all["States"];

var option = document.createElement("option");
option.value = "Todos";
option.text = "Todos";
select.appendChild(option);

for (const state of all_states)
{
    var option = document.createElement("option");
    option.value = state;
    option.text = state.charAt(0).toUpperCase() + state.slice(1);
    select.appendChild(option);
}
select.value = object_all["State"];

selectCourse = document.getElementById("courseComparation")

all_courses = object_all["Courses"];

var option = document.createElement("option");
option.value = "Todos";
option.text = "Todos";
selectCourse.appendChild(option);

for (const course of all_courses)
{
    var option = document.createElement("option");
    option.value = course;
    option.text = course.charAt(0).toUpperCase() + course.slice(1);
    selectCourse.appendChild(option);
}
selectCourse.value = object_all["Course"];

selectGender = document.getElementById("genderComparation")

all_genders = object_all["Genders"];

for (const gender of all_genders)
{
    var option = document.createElement("option");
    option.value = gender;
    option.text = gender.charAt(0).toUpperCase() + gender.slice(1);
    selectGender.appendChild(option);
}
selectGender.value = object_all["Gender"];

createGraphGenderCourseComparation(object_all)
}
}
</script>

<!-- Execucao inicial do método init -->
<script>
    document.getElementById('no-data-gender-course-comparation').style.display = 'none';
    var chartGenderCourseComparation;
    var genderCourseComparation = {{ generoXcursoCompare | safe }}
    initGenderCourseComparation(genderCourseComparation);
</script>
